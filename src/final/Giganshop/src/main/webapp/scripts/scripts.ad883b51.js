"use strict";angular.module("shoppingApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngStorage"]).config(["$routeProvider",function(a){a.when("/home",{title:"Inicio",templateUrl:"views/main.html",controller:"MainCtrl"}).when("/cart",{title:"Carrito",templateUrl:"views/cart.html",controller:"CartCtrl"}).when("/shop",{title:"Productos",templateUrl:"views/shop.html",controller:"ShopCtrl"}).when("/login",{title:"Iniciar sesi√≥n",templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/checkout",{title:"Checkout",templateUrl:"views/order.html",controller:"OrderCtrl"}).otherwise({redirectTo:"/home"})}]).run(["$location","$rootScope",function(a,b){b.$on("$routeChangeSuccess",function(a,c){b.title=c.$$route.title})}]),angular.module("shoppingApp").controller("MainCtrl",["$scope",function(a){a.products=["product1","product2","product3"]}]),angular.module("shoppingApp").controller("ContactCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("shoppingApp").controller("CartCtrl",["$scope","CartService","PaymentService",function(a,b,c){a.cart=b.getCart(),a.availablePaymentMethods=c.getPaymentMethods(),a.paymentMethod={},a.addOffer=function(a){b.addOffer(a)},a.removeOffer=function(a){b.removeOffer(a)},a.addProduct=function(a){b.addProduct(a)},a.removeProduct=function(a){b.removeProduct(a)},a.saveCart=function(){b.save()},a.loadCart=function(){b.get()},a.sendOrder=function(){b.sendOrder(a.paymentMethod)}}]),angular.module("shoppingApp").controller("ShopCtrl",["$scope","Offers","Products","CartService","CategoryService",function(a,b,c,d,e){var f=function(b){a.products=b},g=function(b){a.offers=b},h=function(b){a.categories=b};c.query(f),b.query(g),e.query(h),a.addProductToCart=function(a){d.addProduct(a)},a.addOfferToCart=function(a){d.addOffer(a)},a.getCartOffer=function(a){return d.getCart().offers[""+a.id]},a.getCartProduct=function(a){return d.getCart().products[""+a.id]},a.name="",a.search=function(a){c.search(a,f),b.search(a,g)},a.searchByCategory=function(a){b.searchByCategory(a,g),c.searchByCategory(a,f)}}]),angular.module("shoppingApp").controller("LoginCtrl",["$scope","LoginService","$location",function(a,b,c){a.isAuthenticated=function(){return b.isAuthenticated()},a.login=function(a){b.login(a)},a.logout=function(){b.logout(),c.path("#/home")}}]),angular.module("shoppingApp").controller("CheckoutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("shoppingApp").service("Products",["$resource","ServerService",function(a,b){this.query=function(c){return a(b.getBaseUrl()+"/products").query({},c)},this.search=function(c,d){return 0==c.length?this.query(d):a(b.getBaseUrl()+"/products/search/"+c).query({},d)},this.searchByCategory=function(c,d){return c?a(b.getBaseUrl()+"/products/search/category/"+c.name).query({},d):this.query(d)}}]).service("Offers",["$resource","ServerService",function(a,b){this.query=function(c){return a(b.getBaseUrl()+"/offers").query({},c)},this.search=function(c,d){return 0==c.length?this.query(d):a(b.getBaseUrl()+"/offers/search/"+c).query({},d)},this.searchByCategory=function(c,d){return c?a(b.getBaseUrl()+"/offers/search/category/"+c.name).query({},d):this.query({},d)}}]),angular.module("shoppingApp").service("CartService",["$resource","$location","ServerService","OrderService","$sessionStorage",function(a,b,c,d,e){this.$storage=e.$default({cart:{offers:{},products:{},total:0}}),this.getCart=function(){return this.$storage.cart};var f=this;this.setCart=function(a){f.$storage.cart=a},this.get=function(){a(c.getBaseUrl()+"/customer/cart").get({},this.setCart)},this.save=function(){a(c.getBaseUrl()+"/customer/cart").save(this.convertCart(this.$storage.cart))},this.sendOrder=function(e){var f=d.buildOrder(this.convertCart(this.getCart()),e);console.log("Order sent: ",f),a(c.getBaseUrl()+"/orders").save(f,function(a){d.setOrder(a),console.log("Order confirmed: ",a),b.path("/checkout")})},this.addProduct=function(a){var b=""+a.id;this.$storage.cart.products[b]?this.$storage.cart.products[b].quantity++:(this.$storage.cart.products[b]=a,this.$storage.cart.products[b].quantity=1),this.updateCartTotal()},this.addOffer=function(a){var b=""+a.id;this.$storage.cart.offers[b]?this.$storage.cart.offers[b].quantity++:(this.$storage.cart.offers[b]=a,this.$storage.cart.offers[b].quantity=1),this.updateCartTotal()},this.removeProduct=function(a){var b=""+a.id;this.$storage.cart.products[b]&&(this.$storage.cart.products[b].quantity=Math.max(this.$storage.cart.products[b].quantity-1,0)),this.updateCartTotal()},this.removeOffer=function(a){var b=""+a.id;this.$storage.cart.offers[b]&&(this.$storage.cart.offers[b].quantity=Math.max(this.$storage.cart.offers[b].quantity-1,0)),this.updateCartTotal()},this.updateCartTotal=function(){var a=0;angular.forEach(this.$storage.cart.products,function(b){a+=b.price*b.quantity}),angular.forEach(this.$storage.cart.offers,function(b){a+=b.price*b.quantity}),this.$storage.cart.total=a},this.convertCart=function(a){var b={offers:[],products:[]};return angular.forEach(a.products,function(a,c){for(var d=0;d<a.quantity;d++)b.products.push({id:parseInt(c)})}),angular.forEach(a.offers,function(a,c){for(var d=0;d<a.quantity;d++)b.offers.push({id:parseInt(c)})}),b}}]),angular.module("shoppingApp").controller("HeaderCtrl",["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path()}}]),angular.module("shoppingApp").service("ServerService",function(){var a="http://localhost:8080";this.getBaseUrl=function(){return a}}),angular.module("shoppingApp").controller("OrderCtrl",["$scope","OrderService",function(a,b){a.order=b.getOrder()}]),angular.module("shoppingApp").service("OrderService",["$resource","ServerService",function(){this.order={},this.setOrder=function(a){this.order=a},this.getOrder=function(){return this.order},this.buildOrder=function(a,b){var c={};return c.cart=a,c.paymentMethod=b,c}}]),angular.module("shoppingApp").service("PaymentService",["$resource","ServerService",function(a,b){this.getPaymentMethods=function(){return a(b.getBaseUrl()+"/payment").query()}}]),angular.module("shoppingApp").service("LoginService",["$resource","$http","ServerService","$sessionStorage",function(a,b,c,d){this.$storage=d;this.isAuthenticated=function(){var a=d.token;return a?(b.defaults.headers.common.Authorization="Bearer "+a,!0):!1};var e=this;this.login=function(b){var d=a(c.getBaseUrl()+"/oauth/token",{},{login:{method:"POST",params:{username:b.username,password:b.password,client_id:"CLIENT_ID",grant_type:"password"}}});d.login(function(a){var b=a.access_token;b&&(e.$storage.token=b)})},this.logout=function(){delete this.$storage.token}}]),angular.module("shoppingApp").service("CategoryService",["$resource","ServerService",function(a,b){this.query=function(c){return a(b.getBaseUrl()+"/category").query({},c)}}]);